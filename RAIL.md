# 用RAIL模型测量性能
RAIL将用户体验分解为几个关键的action；通过绘制出思考性能的这样一套模型，可以确保设计师和开发者实现更好的用户体验   

在讲RAIL之前，先了解下用户感知到性能延迟的一些关键指标：   

不同的硬件设备、网络环境，用户对于性能延迟的感知会有所不同；比如PC用户和3G网络的Mobile用户，PC用户感受到页面加载延迟的值是1000ms，而3G网络的Mobile用户可以接受的延迟值为5000ms。Mobile用户相比PC用户而言，更有耐心   
上图中的指标，适用于4G,Wifi,PC用户

RAIL包含了4部分：   
* R: Response   
* A: Animation   
* I: Idle   
* L: Load   

## Response
目标：100ms内对用户输入做出反应  
    如果响应超过100ms, 用户输入与反应之间的联系就会被中断，用户可以感受到延迟；这个指标适用于大部分的输入方式，比如点击按钮，toggle表单控件，或者开始动画； 对于拖拽、滚动并不适用   
    事件处理函数最好在50ms内完成，因为浏览器的事件处理机制，用户触发输入后，事件会进入队列中，可能需要50ms左右的时间才能执行到事件处理函数   
    如图：   
指导方针： 
* 可能听起来有点反常规，最好不要立刻响应用户输入。最大化的利用这100ms去完成一些耗时的工作，但要对用户无感知
* 对于超过100ms的响应，一定要提供反馈

## 动画
目标： 每10ms（内）一帧
从技术上来讲，临界值为每帧16ms(1000ms/60帧)。但是浏览器需要花费6ms的时间绘制1帧，所以要将每帧时间控制在10ms   
指导方针：    
* 尽可能的少做事，只处理必须要处理的   
* 可以利用100ms的输入相应时间，在动画触发之前，完成一些需要复杂计算的工作   
* 如下这些都视为动画：
   * 页面切换动画（入场动画、离场动画等）
   * 滚动 包括释放滚动后，页面的继续滑动
   * 拖拽 例如 地图的放大、缩小

## 空闲时间
目标： 最大化的利用空闲时间来保证100ms的响应时间，保证动画的流畅   
指导方针：   
* 利用空闲时间完成不紧急的工作。 比如页面的初始化加载中，尽可能的少加载资源；其余的非必要资源放到空闲时间加载
* 将工作分为耗时小于50ms的代码块执行；大于50ms的话，就会影响及时响应用户输入

## 加载
目标： 在理想时间内呈现页面给用户，并可以交互   
不同的网络环境、硬件设备，时间阈值不同；具体的阈值还需要找到论据   
指导方针：
* 识别影响加载性能的因素
    * 网络速度和延迟
    * 硬件
    * js的解析等
* 没必要在指定的时间内加载完所有的资源；做到渐进式加载渲染，将不必要的资源放到空闲时间去加载和执行



## 入场
当讨论页面性能的时候，人们很容易陷入误区   
比如经常会听到有人说：我刚测了下，页面加载速度是2s   
这句话本身没有错，但并不能准确的反应现实；有这么几点误区:
* 页面加载时间随用户的网络情况和设备硬件的变化而不同；单一的数字并不能反应这种区别   
    考虑到设备很多，可以根据网络情况对加载速度分组
